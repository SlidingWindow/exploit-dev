// Hooking.cpp : Defines the exported functions for the DLL application.
//

//#include "stdafx.h"
/*hook.c*/ //Visual Studio 2013

/*Turns the Caps Lock on permanently. 
 Author: SlidingWindow, Twitter: @Kapil_Khot

 */




#include<windows.h>
static HHOOK hkb = NULL;
HANDLE h;

BOOL __stdcall DllMain(HANDLE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)
{
	h = hModule;	//Handle to the DLL in memory... Base address of the DLL.
	return TRUE;
}


//An exported function 'KeyboardProc' that can be called from external programs/executables.
//__declspec ( dllexport ) indicates that this is an exported function.

LRESULT __declspec(dllexport) __stdcall KeyboardProc(int nCode, WPARAM wParam, LPARAM lParam)
{
	short int state;

	if (nCode < 0)
		return CallNextHookEx(hkb, nCode, wParam, lParam);

	if ((nCode == HC_ACTION) && ((DWORD)lParam & 0x40000000))
	{
		state = GetKeyState(VK_CAPITAL);
		if ((state & 1) == 0) /*if off*/
		{
			keybd_event(VK_CAPITAL, 0, KEYEVENTF_EXTENDEDKEY, 0);
			keybd_event(VK_CAPITAL, 0, KEYEVENTF_EXTENDEDKEY | KEYEVENTF_KEYUP, 0);
		}
	}
	return CallNextHookEx(hkb, nCode, wParam, lParam);
}

//An exported function 'installhook' that can be called from external programs/executables.
//__declspec ( dllexport ) indicates that this is an exported function.

BOOL __declspec(dllexport) installhook()
{
	hkb = SetWindowsHookEx(WH_KEYBOARD, (HOOKPROC)KeyboardProc, (HINSTANCE)h, 0);

	if (hkb == NULL)
		return FALSE;

	return TRUE;
}


//An exported function 'removehook' that can be called from external programs/executables.
//__declspec ( dllexport ) indicates that this is an exported function.

BOOL __declspec(dllexport) removehook()
{
	return UnhookWindowsHookEx(hkb);
}