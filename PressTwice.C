// PressItTwiceDLL.cpp : Defines the exported functions for the DLL application.
//

//#include "stdafx.h"


/*PressItTwice.c*/

/*Makes every key pressed appear twice.
 Author: SlidingWindow, Twitter: @Kapil_Khot

 */

#include<windows.h>
static HHOOK hkb = NULL;
HANDLE h;

BOOL __stdcall DllMain(HANDLE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)
{
	h = hModule;	// Handle to the DLL in memory. It's the base address of DLL.
	return TRUE;

}

//An ecporeted functiokn 'KeyboardProc' that can be called from external programs/excecutables.
//__declspec(dllexport) indicates that this is an exported function

LRESULT __declspec(dllexport) __stdcall KeyboardProc(int nCode, WPARAM wParam, LPARAM lParam)
{
	static BYTE key;
	static BOOL flag = FALSE;

	if (nCode < 0)
	{
		return CallNextHookEx(hkb, nCode, wParam, lParam);
	}

	if ((nCode == HC_ACTION) && ((DWORD)lParam & 0x80000000) == 0)
	{
		if (flag == FALSE)
		{
			key = wParam;
			keybd_event(key, 0, KEYEVENTF_EXTENDEDKEY, 0);
			flag = TRUE;
		}
		else
		{
			if (key == (BYTE)wParam)
			{
				flag = FALSE;
			}
		}
	}

	return CallNextHookEx(hkb, nCode, wParam, lParam);
}

BOOL __declspec(dllexport) installhook()
{
	hkb = SetWindowsHookEx(WH_KEYBOARD,(HOOKPROC)KeyboardProc,(HINSTANCE)h,0);
	if (hkb == NULL)
	{
		return FALSE;
	}

	return TRUE;
}

LRESULT __declspec(dllexport) removehook()
{
	return UnhookWindowsHookEx(hkb);
}

